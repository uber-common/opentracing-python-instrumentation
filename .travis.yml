dist: xenial
sudo: true

language: python

matrix:
  include:
  - python: '2.7'
    env: COVER=1
  - python: '3.4'
    dist: trusty
  - python: '3.5'
  - python: '3.6'
  - python: '3.7'

install:
  - make install-ci

services:
  - docker
  - postgresql
  - redis

before_script:
  - docker-compose up -d dynamodb
  - psql -c 'create database test;' -U postgres

  # waiting for DynamoDB
  - while [[ $(curl -so /dev/null -w '%{response_code}' localhost:8000) != '400' ]]; do sleep 1; done

  # workaround for Travis CI issue #7940
  # https://github.com/travis-ci/travis-ci/issues/7940
  - sudo rm -f /etc/boto.cfg

script:
  - make test lint

after_success:
  if [ "$COVER" = "1" ]; then coveralls -v ; fi
